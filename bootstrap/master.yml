---
- hosts: "{{ node_prefix }}-{{ node_count }}"
  become: true
  gather_facts: yes
  tasks:
  - name: Install Master Reqs
    include_role:
      name: master
      tasks_from: install_prereqs
  
  - name: Install master and worker packages
    include_role:
      name: master_and_workers
      tasks_from: setup
  
  #- name: Install CRI
  #  include_role:
  #    name: master_and_workers
  #    tasks_from: install_cri
  
  #- name: Install Kube Packages
  #  include_role:
  #    name: master_and_workers
  #    tasks_from: install_kube_packages
  
  - name: Master Join
    include_role:
      name: master
      tasks_from: master_join
  
  - name: Allow master nodes to run pods
    include_role:
      name: master
      tasks_from: master_runpods
    when: worker_nodes == "0"

  - name: Install Proxy
    include_role:
      name: master_and_workers
      tasks_from: install_proxy

- name: Install APPs
  ansible.builtin.import_playbook: apps.yml
  when: worker_nodes == "0"