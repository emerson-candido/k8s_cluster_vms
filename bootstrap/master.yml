---
- hosts: "{{ node_prefix }}-{{ node_count }}"
  become: true
  gather_facts: yes
  tasks:
  - name: Install Master Reqs
    include_role:
      name: master
      tasks_from: install_prereqs
  
  - name: Install master and worker packages
    include_role:
      name: master_and_workers
      tasks_from: setup
  
  - name: Master Join
    include_role:
      name: master
      tasks_from: master_join
  
  - name: No worker nodes
    block:
    - name: Allow master nodes to run pods
      include_role:
        name: master
        tasks_from: master_runpods

    - name: Install APPs
      include_role:
        name: apps
        tasks_from: apps
    when: worker_nodes == "0"