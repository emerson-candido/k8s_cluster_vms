---
- name: Install pushgateway
  kubernetes.core.helm:
    name: "pushgateway"
    chart_ref: "prometheus-pushgateway"
    chart_version: "{{ pushgateway_chart_version }}"
    chart_repo_url: "https://prometheus-community.github.io/helm-charts"
    release_namespace: monitoring
    create_namespace: true
    values:
      service:
        type: NodePort
        nodePort: 30011
  become: false
  delegate_to: "localhost"
  when: node_numbers == node_count