---
- name: Create Example Volumes Directories
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
  with_items:
  - "{{ gluster_directory }}/pv01"
  - "{{ gluster_directory }}/pv02"
  - "{{ gluster_directory }}/pv03"

- name: Create Gluster volumes (Run only on last node)
  ansible.builtin.shell:
    cmd: |
      a=1
      until [ ! $a -le {{ node_numbers }} ]
      do 
        echo -n "{{ node_subnet }}.$(( $a + {{ node_range }} )):{{ item }} " >> volumes_{{ item.split('/')[-1] }}.txt
        a=`expr $a + 1`
      done
      gluster volume create {{ item.split('/')[-1] }} replica {{ node_numbers }} $(cat volumes_{{ item.split('/')[-1] }}.txt)
      gluster volume start {{ item.split('/')[-1] }}
  with_items:
  - "{{ gluster_directory }}/pv01"
  - "{{ gluster_directory }}/pv02"
  - "{{ gluster_directory }}/pv03"
  when: node_numbers == node_count