---
- name: Install LVM
  ansible.builtin.apt: 
    name: "{{ packages }}"
    state: present
    update_cache: yes
  vars:
    packages:
    - python-software-properties
    - xfsprogs
    - lvm2

- name: Create Volume Group
  community.general.lvg:
    vg: "{{ disk_name }}"
    pvs: "/dev/{{ disk_device }}"
    pvresize: yes

- name: Create the Logical Volume
  community.general.lvol:
    lv: "{{ disk_name }}-{{ disk_device }}"
    vg: "{{ disk_name }}"
    size: "{{ disk_size | int -1 }}G"
    state: present

- name: creating new filesystem on new LVM logical volume
  community.general.filesystem:
    fstype: "{{ disk_fs }}"
    dev: /dev/{{ disk_name }}/{{ disk_name }}-{{ disk_device }}

- name: Mounting new filesystem
  ansible.posix.mount:
    path: "{{ disk_directory }}"
    src: /dev/{{ disk_name }}/{{ disk_name }}-{{ disk_device }}
    fstype: "{{ disk_fs }}"
    state: mounted