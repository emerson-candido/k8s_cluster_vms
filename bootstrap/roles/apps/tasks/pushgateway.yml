---
- name: Install pushgateway
  kubernetes.core.helm:
    name: "pushgateway"
    chart_ref: "prometheus-pushgateway"
    chart_version: "{{ pushgateway_chart_version }}"
    chart_repo_url: "https://prometheus-community.github.io/helm-charts"
    release_namespace: monitoring
    create_namespace: true
    values:
      ingress:
        enabled: true
        annotations:
          kubernetes.io/ingress.class: nginx
          nginx.ingress.kubernetes.io/rewrite-target: /$2
        hosts: ["k8s"]
        path: /pushgateway
        pathType: Prefix
  become: false
  delegate_to: "localhost"